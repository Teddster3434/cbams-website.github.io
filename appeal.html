<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CBAMS Ban Appeals & Admin Panel</title>

  <style>
    body { font-family: Arial, sans-serif; background: #f0f4f8; padding: 20px; }
    #adminPanel { display: none; background: white; padding: 20px; border-radius: 8px; max-width: 600px; margin: 20px auto; }
    #loginDiv { max-width: 400px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; }
    #appealForm { max-width: 400px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; }
    label { display: block; margin-top: 10px; }
    input, textarea { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 15px; padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    ul { list-style: none; padding: 0; }
    li { background: #e7f3ff; margin-bottom: 10px; padding: 10px; border-radius: 5px; }
    .logout-btn { background: #dc3545; margin-top: 10px; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

</head>
<body>

  <!-- Appeal Submission Form -->
  <div id="appealForm">
    <h2>Submit Ban Appeal</h2>
    <form id="form">
      <label>Roblox Username
        <input type="text" id="username" required />
      </label>
      <label>User ID
        <input type="text" id="userid" required />
      </label>
      <label>Reason for Appeal
        <textarea id="reason" rows="4" required></textarea>
      </label>
      <button type="submit">Submit Appeal</button>
      <p id="formStatus"></p>
    </form>
  </div>

  <!-- Login Panel -->
  <div id="loginDiv">
    <h2>Staff Login</h2>
    <form id="loginForm">
      <label>Email
        <input type="email" id="email" required />
      </label>
      <label>Password
        <input type="password" id="password" required />
      </label>
      <button type="submit">Login</button>
    </form>
    <p id="loginStatus"></p>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <h2>Admin Panel - Ban Appeals</h2>
    <button id="logoutBtn" class="logout-btn">Logout</button>
    <ul id="appealsList">Loading appeals...</ul>
  </div>

<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAIhuYRzhkaCf6Ds8IIgTl_Pbe0MRrF3WU",
    authDomain: "cbams-website.firebaseapp.com",
    databaseURL: "https://cbams-website-default-rtdb.firebaseio.com",
    projectId: "cbams-website",
    storageBucket: "cbams-website.firebasestorage.app",
    messagingSenderId: "757319864195",
    appId: "1:757319864195:web:afb8f91a8b2b355f6f70b6",
    measurementId: "G-7SP5QR7MK7"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // Elements
  const appealFormDiv = document.getElementById('appealForm');
  const form = document.getElementById('form');
  const formStatus = document.getElementById('formStatus');

  const loginDiv = document.getElementById('loginDiv');
  const loginForm = document.getElementById('loginForm');
  const loginStatus = document.getElementById('loginStatus');

  const adminPanel = document.getElementById('adminPanel');
  const appealsList = document.getElementById('appealsList');
  const logoutBtn = document.getElementById('logoutBtn');

  // Submit appeal function
  form.addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const userid = document.getElementById('userid').value.trim();
    const reason = document.getElementById('reason').value.trim();

    if (!username || !userid || !reason) {
      formStatus.style.color = 'red';
      formStatus.textContent = "Please fill in all fields.";
      return;
    }

    formStatus.style.color = 'black';
    formStatus.textContent = "Submitting...";

    const newAppealRef = db.ref('appeals').push();
    newAppealRef.set({
      username: username,
      userid: userid,
      reason: reason,
      timestamp: Date.now()
    })
    .then(() => {
      formStatus.style.color = 'green';
      formStatus.textContent = "Appeal submitted! Thank you.";
      form.reset();
    })
    .catch(error => {
      formStatus.style.color = 'red';
      formStatus.textContent = "Error submitting appeal: " + error.message;
    });
  });

  // Login form
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const email = loginForm.email.value.trim();
    const password = loginForm.password.value.trim();

    loginStatus.style.color = 'black';
    loginStatus.textContent = "Logging in...";

    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        loginStatus.textContent = "";
        loginForm.reset();
      })
      .catch(error => {
        loginStatus.style.color = 'red';
        loginStatus.textContent = "Login failed: " + error.message;
      });
  });

  // Logout button
  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  // Handle auth state changes to toggle UI
  auth.onAuthStateChanged(user => {
    if (user) {
      // Show admin panel, hide login & appeal form
      adminPanel.style.display = 'block';
      loginDiv.style.display = 'none';
      appealFormDiv.style.display = 'none';
      loadAppeals();
    } else {
      // Show appeal form and login, hide admin
      adminPanel.style.display = 'none';
      loginDiv.style.display = 'block';
      appealFormDiv.style.display = 'block';
      appealsList.innerHTML = '';
    }
  });

  // Load appeals and show them in the list
  function loadAppeals() {
    appealsList.innerHTML = "Loading appeals...";
    db.ref('appeals').on('value', snapshot => {
      appealsList.innerHTML = "";
      const appeals = snapshot.val();
      if (appeals) {
        Object.entries(appeals).forEach(([key, appeal]) => {
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>Username:</strong> ${escapeHtml(appeal.username)}<br/>
            <strong>User ID:</strong> ${escapeHtml(appeal.userid)}<br/>
            <strong>Reason:</strong> ${escapeHtml(appeal.reason)}<br/>
            <em>Submitted: ${new Date(appeal.timestamp).toLocaleString()}</em>
          `;
          appealsList.appendChild(li);
        });
      } else {
        appealsList.textContent = "No appeals found.";
      }
    });
  }

  // Escape HTML to prevent injection
  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, function(m) {
      return ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m];
    });
  }
</script>

</body>
</html>
